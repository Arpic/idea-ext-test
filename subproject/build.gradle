plugins {
    id "java"
    id "org.jetbrains.gradle.plugin.idea-ext" version "1.1.3"
}

idea.module.settings {    
    withModuleXml { XmlProvider p ->
        moduleXml.asNode().appendNode('foo', [name: 'bar'])
        throw new IllegalStateException("Some exception")
    }
}